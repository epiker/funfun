function getFileList(a){var b,c;$("#path_container").val(nowPath),b=path+"/core/server/image/list",c=new Object,c.filePath=a,sw.showProcessBar(),sw.ajaxSubmit(b,c,function(a){files=a,constructImages(),sw.hideProcessBar()})}function constructImages(){var a,b,c,d;if(search(),showFiles.sort(orderBy),nowFileId="",nowFile="",a=$("#show_type").val(),"0"==a){for(b="",b+='<table class="table">',c=0;c<showFiles.length;c++)d=showFiles[c],b+='<tr id="file_'+c+'" title="'+d.full_name+'" file_full_name="'+d.full_name+'" file_name="'+d.name+'" class="list-'+("1"==d.is_dir?"folder":"image")+" file-single "+("1"==d.is_dir?"type-dir":"type-file")+'">',b+="	<td>"+("1"==d.is_dir?'<i class="fa fa-folder-o"></i>':'<i class="fa fa-image"></i>')+"&nbsp;&nbsp;"+d.full_name+"</td>",b+="	<td>"+("1"==d.is_dir?"-":getFileSize(d.size))+"</td>",b+="	<td>"+d.create_time+"</td>",b+="</tr>";b+="</table>",$("#show_images_container").html(b)}else{for(b="",c=0;c<showFiles.length;c++)d=showFiles[c],b+='<div id="file_'+c+'" title="'+d.full_name+'" file_full_name="'+d.full_name+'" file_name="'+d.name+'" class="file file-single '+("1"==d.is_dir?"type-dir":"type-file")+'">',b+='	<div class="thumbnail">',b+='		<div class="caption">',b+="1"==d.is_dir?'			<h3><i class="fa fa-folder-o"></i></h3>':'			<img width="100%" height="53" src="'+(previewPath+nowPath+d.full_name)+'" />',b+="			<p>"+d.full_name+"</p>",b+="		</div>",b+="	</div>",b+="</div>";$("#show_images_container").html(b)}bindMethod()}function bindMethod(){$(".file-single").mouseover(function(){$(this).addClass("file-single-hover")}).mouseout(function(){$(this).removeClass("file-single-hover")}),$(".file-single").click(function(){$(".file-single").removeClass("file-single-select"),$(this).addClass("file-single-select"),nowFileId=this.id.split("_")[1],nowFile=$(this).attr("file_full_name"),$("#file_name").val($(this).attr("file_name"))}),$(".type-dir").dblclick(function(){nowPath+=$(this).attr("file_full_name")+"/",uploaderParams.nowPath=nowPath,uploader.setPostParams(uploaderParams),getFileList(nowPath)}),"1"==isSelect&&$(".type-file").dblclick(function(){var a=previewPath+nowPath+$(this).attr("file_full_name");sw.getTopWindow(window).model_args["selectImageReturnValue"]=a,parent.sw.closeWindow("self")})}function goBack(){"/"!=nowPath&&(nowPath=nowPath.substr(0,nowPath.length-1),nowPath=nowPath.substr(0,nowPath.lastIndexOf("/"))+"/",uploaderParams.nowPath=nowPath,uploader.setPostParams(uploaderParams),getFileList(nowPath))}function refresh(){getFileList(nowPath)}function fakeRefresh(){constructImages()}function search(){var a,b,c;if(showFiles=new Array,a=$("#search_content").val(),""!=a)for(b=0;b<files.length;b++)c=files[b],-1!=c.full_name.indexOf(a)&&showFiles.push(c);else showFiles=files}function orderBy(a,b){var c=$("#order").val(),d=$("#order_type").val(),e=0;return"0"==c&&(e="1"==a.is_dir&&"0"==b.is_dir?-1:"0"==a.is_dir&&"1"==b.is_dir?1:a.name.localeCompare(b.name)),"1"==c&&(e=a.size-b.size),"2"==c&&(e=a.create_time_long-b.create_time_long),"1"==d&&(e=-1*e),e}function addFolder(){var a=path+"/core/server/image/add",b=new Object;b.nowPath=nowPath,b.fileName=$("#file_name").val(),sw.showProcessBar(),sw.ajaxSubmit(a,b,function(a){if("0"==a.success)sw.toast(a.message,"warning",3e3);else{var b=new Object;b.name=a.name,b.full_name=a.full_name,b.extension=a.extension,b.is_dir=a.is_dir,b.size=a.size,b.create_time_long=a.create_time_long,b.create_time=a.create_time,files.push(b),fakeRefresh(),sw.toast(a.message,"success",3e3)}sw.hideProcessBar()})}function modifyFileName(){var a,b;return""==nowFileId?(sw.toast("请选择需要重命名的文件或文件夹！","warning",3e3),void 0):(a=path+"/core/server/image/rename",b=new Object,b.nowPath=nowPath,b.nowFile=nowFile,b.fileName=$("#file_name").val(),sw.showProcessBar(),sw.ajaxSubmit(a,b,function(a){if("0"==a.success)sw.toast(a.message,"warning",3e3);else{var b=new Object;b.name=a.name,b.full_name=a.full_name,b.extension=a.extension,b.is_dir=a.is_dir,b.size=a.size,b.create_time_long=a.create_time_long,b.create_time=a.create_time,files.splice(nowFileId,1,b),fakeRefresh(),sw.toast(a.message,"success",3e3)}sw.hideProcessBar()}),void 0)}function deleteFile(){var a,b;return""==nowFileId?(sw.toast("请选择需要删除的文件或文件夹！","warning",3e3),void 0):(confirm("确定要删除此文件吗？")&&(a=path+"/core/server/image/delete",b=new Object,b.nowPath=nowPath,b.nowFile=nowFile,sw.showProcessBar(),sw.ajaxSubmit(a,b,function(a){"0"==a.success?sw.toast(a.message,"warning",3e3):(files.splice(nowFileId,1),fakeRefresh(),sw.toast(a.message,"success",3e3)),sw.hideProcessBar()})),void 0)}function selectImage(){if($(".file-single-select").hasClass("type-dir"))return sw.toast("您不能选择文件夹，请选择图片。","warning",3e3),void 0;var a=$(".file-single-select").attr("file_full_name");modalCallback(a),closeModal("selectImage",parent)}function clearImage(){modalCallback(""),closeModal("selectImage",parent)}var files,showFiles,modalCallback,nowPath="/",nowFileId="",nowFile="";$(function(){getFileList(nowPath)});